# Quick Vworld Plugin - 테스트 가이드

## 테스트 목표

`lt_c_upisuq153` (도시계획시설-공간시설) 레이어로 플러그인의 모든 기능을 테스트합니다.

## 사전 준비

### 1. QGIS 설치
- QGIS 3.22 이상 버전이 설치되어 있어야 합니다
- QGIS를 실행하고 새 프로젝트를 생성합니다

### 2. 플러그인 설치
```bash
# Windows
cd C:\Users\[username]\AppData\Roaming\QGIS\QGIS3\profiles\default\python\plugins

# 현재 폴더를 QuickVworld로 복사하거나 심볼릭 링크 생성
```

### 3. QGIS 재시작
플러그인을 인식하도록 QGIS를 재시작합니다.

### 4. 플러그인 활성화
- 메뉴: `Plugins` → `Manage and Install Plugins`
- "Installed" 탭에서 "Quick Vworld" 검색
- 체크박스를 선택하여 플러그인 활성화

## 테스트 케이스

### 테스트 1: 캔버스 범위로 다운로드

**목적**: 현재 맵 캔버스의 표시 영역을 기준으로 데이터 다운로드

**단계**:
1. QGIS에서 베이스맵 추가 (예: OpenStreetMap)
   - 브라우저 패널 → XYZ Tiles → OpenStreetMap
2. 서울 지역으로 줌인 (예: 강남구 일대)
   - 좌표 예시: 경도 127.0, 위도 37.5
3. 툴바에서 Quick Vworld 아이콘 클릭 또는 메뉴에서 실행
4. 다이얼로그에서 설정:
   - 범위 선택: "캔버스 범위" (기본값)
   - 레이어 타입: "도시계획시설(공간시설) (lt_c_upisuq153)"
5. "다운로드" 버튼 클릭

**예상 결과**:
- 진행 상황이 표시됨
- 다운로드 완료 후 성공 메시지 표시
- 레이어가 프로젝트에 자동으로 추가됨
- 레이어에 공간시설 데이터가 표시됨 (공원, 녹지 등)

**확인 사항**:
- [ ] 다운로드가 성공적으로 완료됨
- [ ] 레이어가 레이어 패널에 나타남
- [ ] 피처 수가 표시됨 (0개가 아님)
- [ ] 지오메트리가 맵에 표시됨
- [ ] 속성 테이블에서 데이터 확인 가능

---

### 테스트 2: 레이어 범위로 다운로드 (전체)

**목적**: 기존 레이어의 전체 범위를 기준으로 데이터 다운로드

**단계**:
1. 작은 범위의 레이어 준비:
   - QGIS에서 임의의 폴리곤 레이어 생성
   - 또는 행정구역 레이어 로드
2. Quick Vworld 플러그인 실행
3. 다이얼로그에서 설정:
   - 범위 선택: "레이어 범위"
   - 레이어 선택: 준비한 레이어 선택
   - "선택한 피처만 사용" 체크 해제
   - 레이어 타입: "도시계획시설(공간시설) (lt_c_upisuq153)"
4. "다운로드" 버튼 클릭

**예상 결과**:
- 선택한 레이어의 전체 범위에서 데이터 다운로드
- 레이어가 프로젝트에 추가됨

**확인 사항**:
- [ ] 레이어 선택 드롭다운이 활성화됨
- [ ] 다운로드가 성공함
- [ ] 다운로드된 범위가 기준 레이어의 범위와 일치함

---

### 테스트 3: 선택된 피처의 범위로 다운로드

**목적**: 레이어에서 선택된 피처만의 범위를 기준으로 데이터 다운로드

**단계**:
1. 벡터 레이어 준비 (행정구역 등)
2. 레이어에서 하나 이상의 피처 선택
   - 선택 도구 사용하여 피처 클릭
   - 또는 속성 테이블에서 선택
3. Quick Vworld 플러그인 실행
4. 다이얼로그에서 설정:
   - 범위 선택: "레이어 범위"
   - 레이어 선택: 피처를 선택한 레이어
   - "선택한 피처만 사용" 체크박스 선택
     - 체크박스 텍스트에 선택된 피처 수 표시되어야 함
   - 레이어 타입: "도시계획시설(공간시설) (lt_c_upisuq153)"
5. "다운로드" 버튼 클릭

**예상 결과**:
- 선택된 피처의 바운딩 박스 범위에서만 데이터 다운로드
- 전체 레이어보다 작은 범위

**확인 사항**:
- [ ] 체크박스에 선택된 피처 수가 표시됨
- [ ] 선택된 피처가 없으면 체크박스가 비활성화됨
- [ ] 다운로드된 데이터가 선택된 피처의 범위 내에 있음

---

### 테스트 4: UI 동작 테스트

**목적**: UI 컨트롤의 상태 변화 확인

**단계**:
1. Quick Vworld 플러그인 실행
2. 범위 선택을 "캔버스 범위"와 "레이어 범위" 사이에서 전환

**예상 결과**:
- "캔버스 범위" 선택 시:
  - 레이어 선택 드롭다운 비활성화
  - "선택한 피처만 사용" 체크박스 비활성화
- "레이어 범위" 선택 시:
  - 레이어 선택 드롭다운 활성화
  - 선택된 피처가 있으면 체크박스 활성화

**확인 사항**:
- [ ] 범위 선택에 따라 컨트롤 상태가 올바르게 변경됨
- [ ] 레이어 타입 변경 시 설명이 업데이트됨
- [ ] 진행 상황 표시가 작동함

---

### 테스트 5: 에러 처리 테스트

**목적**: 오류 상황에서 적절한 메시지 표시

**테스트 케이스**:

#### 5.1 레이어 미선택
1. 범위 선택: "레이어 범위"
2. 레이어 선택: "(벡터 레이어 없음)" 또는 선택 안 함
3. "다운로드" 클릭

**예상 결과**: "레이어를 선택해주세요" 경고 메시지

#### 5.2 선택된 피처 없음
1. 범위 선택: "레이어 범위"
2. 레이어 선택: 피처가 선택되지 않은 레이어
3. "선택한 피처만 사용" 체크
4. "다운로드" 클릭

**예상 결과**: "선택된 피처가 없습니다" 경고 메시지

#### 5.3 네트워크 오류 시뮬레이션
- 인터넷 연결을 끊고 다운로드 시도
- **예상 결과**: 네트워크 오류 메시지 표시

**확인 사항**:
- [ ] 모든 에러 케이스에서 적절한 메시지 표시
- [ ] 에러 후에도 다이얼로그가 정상 작동
- [ ] "다운로드" 버튼이 다시 활성화됨

---

## 추가 검증 항목

### 데이터 품질 확인

1. **속성 데이터**:
   - 다운로드된 레이어의 속성 테이블 열기
   - VWorld에서 제공하는 필드들이 있는지 확인
   - 필드 값이 정상적으로 입력되어 있는지 확인

2. **지오메트리**:
   - 폴리곤이 제대로 표시되는지 확인
   - 지오메트리 검증 도구로 유효성 확인
   - 좌표계가 EPSG:4326으로 설정되어 있는지 확인

3. **메타데이터**:
   - 레이어 속성 → 메타데이터 탭
   - 라이선스, 권리 정보 등이 설정되어 있는지 확인

### 로그 확인

1. QGIS 메뉴: `View` → `Panels` → `Log Messages`
2. 'QuickVworld' 탭 선택
3. 로그 메시지 확인:
   - INFO: 정상 작동 로그
   - WARNING: 경고
   - ERROR: 오류 메시지

---

## 테스트 결과 기록

### 테스트 환경
- QGIS 버전: _____________
- OS: _____________
- 테스트 날짜: _____________

### 결과 요약

| 테스트 케이스 | 결과 | 비고 |
|--------------|------|------|
| 1. 캔버스 범위 | ☐ Pass ☐ Fail | |
| 2. 레이어 범위 (전체) | ☐ Pass ☐ Fail | |
| 3. 선택된 피처 범위 | ☐ Pass ☐ Fail | |
| 4. UI 동작 | ☐ Pass ☐ Fail | |
| 5. 에러 처리 | ☐ Pass ☐ Fail | |

### 발견된 이슈

1. _____________________________________________
2. _____________________________________________
3. _____________________________________________

---

## 문제 발생 시

### 디버깅 체크리스트

1. **QGIS 버전 확인**:
   ```
   메뉴: Help → About → 버전 정보 확인
   ```

2. **플러그인 경로 확인**:
   ```
   설정 → 옵션 → 시스템 → 환경 → 플러그인 경로
   ```

3. **Python 콘솔에서 직접 테스트**:
   ```python
   # QGIS Python 콘솔 열기
   from QuickVworld.core.api.vworld_client import VworldWFSClient
   from qgis.core import QgsRectangle
   
   # 테스트 다운로드
   client = VworldWFSClient()
   bbox = QgsRectangle(126.9, 37.4, 127.1, 37.6)
   result = client.fetch_data('lt_c_upisuq153', bbox)
   print(f"Result: {result}")
   ```

4. **상세 로그 확인**:
   - 로그 메시지 패널의 QuickVworld 탭
   - 에러 스택 트레이스 확인

---

## 성공 기준

다음 조건이 모두 충족되면 테스트 성공:

- ✅ 모든 테스트 케이스 통과
- ✅ 데이터가 올바르게 다운로드되고 표시됨
- ✅ 에러 상황이 적절히 처리됨
- ✅ UI가 직관적으로 작동함
- ✅ 로그에 심각한 오류 없음

